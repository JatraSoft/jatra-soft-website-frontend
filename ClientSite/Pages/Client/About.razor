@page "/about"
@using ClientSite.Models
@using ClientSite.Services
@inject AboutService AboutService
@using ClientSite.Pages.Components

<!-- ---  Hero Section --- -->
<section class="pt-5" style="background-color: #f7faff;">
    <div class="container text-center py-5">
        <p class="base-subtitle-text mb-2">OUR JOURNEY SO FAR</p>
        <h1 class="base-main-title mb-3">
            Building the Digital Future with <span style="color: #3CB9E0;">Jatra Software</span>
        </h1>
        <p class="base-section-description mx-auto" style="max-width: 800px;">
            Jatra Software Ltd was founded in 2024 with a singular focus to transform challenging business problems into elegant, scalable, and intuitive digital solutions. Since our inception, we have partnered with over 50+ clients globally, delivering more than 100 innovative projects across various industries, from FinTech to E-commerce. We are driven by a passion for technology and a deep commitment to our clients' success, treating every engagement as the beginning of a shared journey.
        </p>
    </div>
</section>

<section class="base-about-section base-white-bg py-5">
    <div class="container">
        @if (isLoading)
        {
            <p class="base-text text-center text-primary">Loading...</p>
        }
        else if (aboutSection == null)
        {
            <p class="base-text text-center text-danger">About section not available.</p>
        }
        else
        {
            @* --- 2. Mission, Vision, and Core Team (Two-Column Layout) --- *@
            <div class="row align-items-center mb-6 py-4">
                @* Increased bottom margin for separation *@
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h3 class="base-sub-heading mb-3" style="color: #000000;">
                        <i class="bi bi-lightbulb-fill me-2"></i> Our Mission & Vision
                    </h3>

                    <div class="mb-4 p-3 rounded" style="border-left: 4px solid #3CB9E0; background-color: #f7faff;">
                        <h4 class="fw-bold mb-1 base-text" style="color: #000000;">Our Mission</h4>
                        <p class="base-text base-sub-description mb-0">
                            To empower businesses with innovative, reliable, and scalable software solutions that accelerate growth, improve efficiency, and deliver exceptional user experiences.
                        </p>
                    </div>

                    <div class="mb-4 p-3 rounded" style="border-left: 4px solid #3CB9E0; background-color: #f7f7f7;">
                        <h4 class="fw-bold mb-1 base-text" style="color: #000000;">Our Vision</h4>
                        <p class="base-text base-sub-description mb-0">
                            To become a leading global technology company recognized for excellence in innovation, quality, and customer success—building digital solutions that shape the future.
                        </p>
                    </div>

                    <a href="/team" class="base-btn-secondary mt-3 px-4 py-2">
                        <i class="bi bi-people me-2"></i> Meet Our Expert Team
                    </a>
                </div>

                <div class="col-lg-6">
                    @* --- Video/Image (Right side) --- *@
                    <div class="base-video-wrapper position-relative rounded-4 overflow-hidden shadow-lg">
                        @if (!string.IsNullOrEmpty(aboutSection.ImageUrl))
                        {
                            <img src="@aboutSection.ImageUrl" alt="@aboutSection.Title" class="img-fluid w-100" />
                        }
                        @if (!string.IsNullOrEmpty(aboutSection.VideoUrl))
                        {
                            <button class="base-play-btn position-absolute top-50 start-50 translate-middle rounded-circle shadow"
                                    data-bs-toggle="modal" data-bs-target="#aboutVideoModal">
                                <i class="bi bi-play-fill fs-2 text-white"></i>
                            </button>
                        }
                    </div>
                </div>
            </div>

            @* --- 3. Core Values (Stat Boxes converted to Value Cards) --- *@
            <div class="text-center mb-5 pt-4">
                <h2 class="base-main-title mb-4">Our Core Values</h2>
            </div>

            <div class="row text-center mb-5 justify-content-center">
                <div class="col-md-4 mb-4">
                    <div class="base-about-stat base-stat-1 shadow">
                        <i class="bi bi-lightbulb-fill fs-1 mb-2" style="color:#0099FF;"></i>
                        <h3 class="fw-bold">Innovation</h3>
                        <p class="base-text">We constantly seek new technologies and creative approaches to solve complex problems.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="base-about-stat base-stat-2 shadow">
                        <i class="bi bi-hand-thumbs-up-fill fs-1 mb-2" style="color:#555555;"></i>
                        <h3 class="fw-bold">Integrity</h3>
                        <p class="base-text">Honesty and transparency are the foundations of all our client relationships.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="base-about-stat base-stat-3 shadow">
                        <i class="bi bi-rocket-takeoff-fill fs-1 mb-2" style="color:#FFFFFF;"></i>
                        <h3 class="fw-bold">Excellence</h3>
                        <p class="base-text">We strive for the highest quality in code, design, and user experience delivery.</p>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

<div class="base-light-bg py-5">
    <WhyChooseUs />
</div>


<Products />


<div class="container base-contact-cta py-5 text-center rounded-4 shadow-lg mt-5 position-relative"
     style="overflow:hidden;">
    @* Removed inline gradient and added custom class *@

    <div class="position-absolute top-0 start-0 w-100 h-100"
         style="background: linear-gradient(135deg, #3CB9E0, #001829);">
    </div>

    <div class="position-relative">
        <h2 class="base-main-title mb-3 text-white">Let’s Build the Future Together 🚀</h2>
        <p class="base-subtitle-text mb-4 text-light" style="color:#FFF;">Have an idea or project in mind? Let’s make it happen with innovation, speed, and impact.</p> @* Changed text class *@

        <a href="/contact" class="base-btn-secondary rounded-pill fw-bold px-5 base-cta-inverted"
           style="background:#fff;">
            <i class="bi bi-chat-dots me-2"></i> Contact Us
        </a>
    </div>
</div>

@* Use embed pattern: store embed url in data-src and let the small JS attach it when modal open (prevents blocked embeds and stops playback when closed) *@
@if (!string.IsNullOrEmpty(aboutSection?.VideoUrl))
{
    var embedUrl = GetYouTubeEmbedUrl(aboutSection.VideoUrl);
    <div class="modal fade" id="aboutVideoModal" tabindex="-1" aria-labelledby="aboutVideoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 rounded-4 overflow-hidden">
                <div class="ratio ratio-16x9">
                    <iframe id="aboutVideo" data-src="@embedUrl" src=""
                            title="@aboutSection.Title"
                            allow="autoplay; encrypted-media; picture-in-picture"
                            allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private AboutSection? aboutSection;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var sections = await AboutService.GetAboutSectionsAsync();
            aboutSection = sections.FirstOrDefault();
        }
        finally
        {
            isLoading = false;
        }
    }

    private string GetYouTubeEmbedUrl(string url)
    {
        if (string.IsNullOrWhiteSpace(url))
            return string.Empty;

        url = url.Trim();

        // Ensure scheme
        if (!url.StartsWith("http://", StringComparison.OrdinalIgnoreCase) &&
            !url.StartsWith("https://", StringComparison.OrdinalIgnoreCase))
        {
            url = "https://" + url;
        }

        // If it's already an embed url, return as-is (ensure https)
        if (url.Contains("/embed/"))
            return url;

        // Short youtu.be links
        var m = System.Text.RegularExpressions.Regex.Match(url, @"youtu\.be\/([^\?&\/]+)");
        if (m.Success)
            return $"https://www.youtube.com/embed/{m.Groups[1].Value}";

        // Standard watch?v=... links (or query param v=)
        m = System.Text.RegularExpressions.Regex.Match(url, @"[?&]v=([^&]+)");
        if (m.Success)
            return $"https://www.youtube.com/embed/{m.Groups[1].Value}";

        // Last resort: try to extract last path segment as id
        m = System.Text.RegularExpressions.Regex.Match(url, @"youtube\.com\/.*\/([^\?&\/]+)$");
        if (m.Success)
            return $"https://www.youtube.com/embed/{m.Groups[1].Value}";

        // Fallback - return original (may fail to embed)
        return url;
    }
}